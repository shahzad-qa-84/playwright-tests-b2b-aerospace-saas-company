{
  "info": {
    "_postman_id": "9baf1797-7f04-412c-8361-877284c6f88f",
    "name": "Delete Workspaces",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "27244149",
    "_collection_link": "https://orange-satellite-403488.postman.co/workspace/b2bSaas-Internal-Testing~b02934fd-4d7e-4034-8348-c43139466a8b/collection/27244149-9baf1797-7f04-412c-8361-877284c6f88f?action=share&source=collection_link&creator=27244149"
  },
  "item": [
    {
      "name": "TC2- Get Workspaces and delete all",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get workspace details by filters\", function () {",
              "    pm.response.to.have.status(200);",
              "",
              "    try {",
              "        // Parse the JSON response",
              "        const responseBody = pm.response.json();",
              "",
              "        // Filter out the IDs with labels starting with \"AutomatedTest_\"",
              "        //const filteredIds = responseBody.filter(item => item.label.trim() === \"\");",
              "        const filteredIds = responseBody.filter(item => item.label.trim().startsWith(\"AutomatedTest_\"));",
              "",
              "",
              "        // Print the filtered IDs",
              "        console.log('Filtered IDs:', filteredIds);",
              "",
              "        // Function to send DELETE request with a delay",
              "        function sendDeleteRequestWithDelay(item, index) {",
              "            setTimeout(() => {",
              "                const id = item.id;",
              "                const apiKey = pm.variables.get('x-api-key');",
              "                const url = pm.variables.get('baseUrl');",
              "                console.log(`ID ${apiKey} API key`);",
              "                pm.sendRequest({",
              "                    method: 'DELETE',",
              "                    url: `${url}/v1/workspace/${id}`, ",
              "                    header: {",
              "                        'Content-Type': 'application/json',",
              "                        'Accept': 'application/json', ",
              "                        'x-api-key': `${apiKey}`, ",
              "                    },",
              "                }, function (err, response) {",
              "                    if (err) {",
              "                        console.error(`Error deleting ID ${id}: ${err}`);",
              "                    } else {",
              "                        console.log(`ID ${id} deleted successfully`);",
              "                    }",
              "                });",
              "            }, index * 2000); // 2000 milliseconds (2 seconds) delay between each request",
              "        }",
              "",
              "        // Loop through the filtered IDs and send DELETE requests with a delay",
              "        filteredIds.forEach((item, index) => {",
              "            sendDeleteRequestWithDelay(item, index);",
              "        });",
              "    } catch (e) {",
              "        console.error('Error parsing JSON response:', e);",
              "    }",
              "});",
              ""
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/v1/workspace?filters=[\"id\",\"label\"]",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "workspace"],
          "query": [
            {
              "key": "filters",
              "value": "[\"id\",\"label\"]"
            }
          ]
        }
      },
      "response": []
    }
  ],
  "auth": {
    "type": "apikey",
    "apikey": [
      {
        "key": "value",
        "value": "{{x-api-key}}",
        "type": "string"
      },
      {
        "key": "key",
        "value": "x-api-key",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ]
}
